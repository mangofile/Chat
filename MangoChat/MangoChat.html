<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title> MangoChat 稳定修复版</title>
    <link rel="stylesheet" href="ass/MangoChatCSS.css">
    <script src="ass/MangoChatDB.js"></script>


</head>
<body>
<div id="app">
    <!-- 顶部 -->
    <div class="header-search">
    <!-- 1. 当前场景显示（点击切换） -->
    <div id="current-scene-display" class="scene-trigger" onclick="toggleScenePicker(event)">
        <div id="scene-icon-active" class="scene-icon"></div>
        <span id="scene-name-active">未设置场景</span>
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"></path></svg>
    </div>

    <!-- 场景切换下拉菜单 -->
    <div id="scene-picker" class="scene-options-dropdown"></div>

    <!-- 2. 搜索框（位置稍微右移） -->
    <div class="search-wrapper">
        <svg class="search-icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" id="search-input" class="search-input" placeholder="检索话术..." oninput="handleSearch()">
    </div>  

    <!-- 3. 白天黑夜 -->
    <div id="theme-toggle-btn" onclick="toggleDarkMode()"></div>

    <!-- 4. 设置按钮 -->
    <div class="admin-btn" onclick="toggleAdminPanel(event)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33-1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
    </div>
    </div>

    <!-- 管理面板 -->
    <div id="admin-panel" class="admin-panel">
        <button onclick="openSceneModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>
        管理聊天场景</button>
        <button onclick="openRoleModal()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 19 13 23 9"></polyline></svg>
            管理角色/头像</button>
        <hr style="border:0; border-top:1px solid #eee; margin:4px 0;">
        <button onclick="exportData()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
            导出话术库</button>
        <button onclick="document.getElementById('import-f').click()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            导入话术库</button>
        <input type="file" id="import-f" hidden accept=".json" onchange="importData(event)">
        <hr style="border:0; border-top:1px solid #eee; margin:4px 0;">
        <button onclick="clearAllData()" style="color:red">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
            清空信息</button>
    </div>

    <div id="chat-window"></div>
    <!-- 回复引用区 -->
    <div id="reply-preview-bar">
    <span id="reply-text"></span>
    <span style="cursor:pointer;color:red;padding:0 5px;" onclick="cancelReply()">✕</span>
    </div>


    <!-- 输入区 -->
    <div class="input-area">
        <div class="toolbar">
            <div class="custom-select-box">
                <div class="select-trigger" id="current-role" onclick="toggleRoleOptions(event)">我</div>
                <div class="select-options" id="role-options"></div>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2" onclick="document.getElementById('file-input').click()" style="cursor:pointer; flex-shrink:0;"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
            <input type="file" id="file-input" hidden accept="image/*,video/*,audio/*">
            <span style="font-size: 11px; color: #bbb; margin-left: auto; flex-shrink:0;">右键菜单 | Shift+Enter 换行</span>
        </div>
        <div class="input-row">
            <textarea id="text-input" placeholder=""></textarea>
            <button class="send-btn" onclick="sendMessage()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
    </div>
</div>


<!-- 场景管理模态框 -->
<div id="scene-modal" class="custom-modal" onclick="if(event.target==this) this.style.display='none'">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:5px;">
            <span>场景管理</span>
            <span style="cursor:pointer; padding:5px;" onclick="document.getElementById('scene-modal').style.display='none'">✕</span>
        </div>
        <div id="scene-list-box" class="role-list-scroll"></div>
        <div class="add-role-row">
            <input type="text" id="new-scene-name" placeholder="新场景名称...">
            <button class="btn-role-add" onclick="addNewScene()">添加</button>
        </div>
    </div>
</div>


<!-- 角色管理模态框 -->
<div id="role-modal" onclick="if(event.target==this) this.style.display='none'">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:5px;">
            <span>角色管理</span>
            <span style="cursor:pointer; padding:5px;" onclick="document.getElementById('role-modal').style.display='none'">✕</span>
        </div>
        <div id="role-list-box" class="role-list-scroll"></div>
        <div class="add-role-row">
            <input type="text" id="new-role-name" placeholder="输入新角色名称...">
            <button class="btn-role-add" onclick="addNewRole()">添加</button>
        </div>
    </div>
</div>



</body>





</html>
